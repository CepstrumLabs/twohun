# site block, listens on the $PORT environment variable, automatically assigned by railway
:{$PORT} {
	# access logs
	log {
		format json # set access log format to json mode
	}

	# Proxy to backend API using Railway's assigned port
	handle /api/* {
		reverse_proxy twohun.railway.internal:{$PORT} {
			health_uri /health
			health_interval 10s
		}
	}

	# health check for railway
	rewrite /health /*

	# serve from the 'dist' folder (Vite builds into the 'dist' folder)
	root * dist

	# enable gzipping responses
	encode gzip

	# serve files from 'dist'
	file_server

	# if path doesn't exist, redirect it to 'index.html' for client side routing
	try_files {path} /index.html
}
